<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <query name="Timesheet.getEntriesBetweenDateForUserId">
        <![CDATA[FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.projectAssignment.user.userId = :userId
        ]]></query>

    <query name="Timesheet.getBookedProjectsInRangeForUserId">
        <![CDATA[SELECT entry.entryId.projectAssignment.assignmentId
        		 FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.projectAssignment.user.userId = :userId
                 GROUP BY entry.entryId.projectAssignment.assignmentId
        ]]></query>
        
    <query name="Timesheet.getBookedDaysInRangeForUserId">
        <![CDATA[SELECT new net.rrm.ehour.timesheet.dto.BookedDay(entry.entryId.entryDate, SUM(entry.hours))
        		 FROM TimesheetEntry entry
                 WHERE entry.entryId.entryDate >= :dateStart AND
                       entry.entryId.entryDate <= :dateEnd AND
                       entry.entryId.projectAssignment.user.userId = :userId
				 GROUP BY entry.entryId.entryDate                       
        ]]></query>   

    <query name="Timesheet.getEntryCountForAssignmentId">
    	SELECT COUNT(entry.entryId.entryDate)
    	FROM TimesheetEntry entry
    	WHERE entry.entryId.projectAssignment.assignmentId = :assignmentId
	</query>   

    <query name="TimesheetComment.getCommentsForUserIdInRange">
    <![CDATA[
    	FROM TimesheetComment comment
    	WHERE comment.commentId.commentDate >= :dateStart AND
    		  comment.commentId.commentDate <= :dateEnd AND
    		  comment.commentId.userId = :userId
    		 ]]>
	</query>   

    <query name="Timesheet.getLatestEntryForAssignmentId">
    	FROM TimesheetEntry entry
    	WHERE entry.entryId.projectAssignment.assignmentId = :assignmentId
    	ORDER BY entry.updateDate DESC
	</query>   
	
    <query name="Timesheet.deleteOnAssignmentIds">
    <![CDATA[
    	DELETE
    	FROM TimesheetEntry entry
    	WHERE entry.entryId.projectAssignment.assignmentId IN (:assignmentIds)
    		 ]]>
	</query>  	
	
    <query name="TimesheetComment.deleteUserId">
    <![CDATA[
    	DELETE 
    	FROM TimesheetComment comment
    	WHERE comment.commentId.userId = :userId
    		 ]]>
	</query>  		
</hibernate-mapping>